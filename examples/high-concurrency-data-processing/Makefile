# RxGo é«˜å¹¶å‘æ•°æ®å¤„ç†ç¤ºä¾‹ Makefile

.PHONY: all run build clean test benchmark profile help

# é»˜è®¤ç›®æ ‡
all: run

# è¿è¡Œæ‰€æœ‰ç¤ºä¾‹
run:
	@echo "ğŸš€ è¿è¡ŒRxGoé«˜å¹¶å‘æ•°æ®å¤„ç†ç¤ºä¾‹..."
	go run .

# æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
build:
	@echo "ğŸ”¨ æ„å»ºç¤ºä¾‹ç¨‹åº..."
	go build -o rxgo-examples .

# è¿è¡Œå•ä¸ªç¤ºä¾‹
run-pipeline:
	@echo "ğŸ“Š è¿è¡Œæ•°æ®å¤„ç†ç®¡é“ç¤ºä¾‹..."
	go run main.go data_pipeline.go

run-batch:
	@echo "ğŸ“¦ è¿è¡Œæ‰¹å¤„ç†ç¤ºä¾‹..."
	go run main.go batch_processor.go

run-crawler:
	@echo "ğŸ•·ï¸ è¿è¡Œç½‘ç»œçˆ¬è™«ç¤ºä¾‹..."
	go run main.go network_crawler.go

run-analytics:
	@echo "ğŸ“ˆ è¿è¡Œæ—¥å¿—åˆ†æç¤ºä¾‹..."
	go run main.go remaining_examples.go

run-stream:
	@echo "ğŸŒŠ è¿è¡Œæµå¤„ç†ç¤ºä¾‹..."
	go run main.go remaining_examples.go

run-mapreduce:
	@echo "ğŸ—ºï¸ è¿è¡ŒMapReduceç¤ºä¾‹..."
	go run main.go remaining_examples.go

# æ€§èƒ½æµ‹è¯•
benchmark:
	@echo "âš¡ è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•..."
	go test -bench=. -benchmem ./...

# æ€§èƒ½åˆ†æ
profile:
	@echo "ğŸ” è¿è¡Œæ€§èƒ½åˆ†æ..."
	go run . -cpuprofile=cpu.prof -memprofile=mem.prof
	@echo "ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹åˆ†æç»“æœ:"
	@echo "go tool pprof cpu.prof"
	@echo "go tool pprof mem.prof"

# æµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	go test ./...

# ä»£ç æ ¼å¼åŒ–
fmt:
	@echo "ğŸ¨ æ ¼å¼åŒ–ä»£ç ..."
	go fmt ./...

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” è¿è¡Œä»£ç æ£€æŸ¥..."
	golangci-lint run

# æ•´ç†ä¾èµ–
mod-tidy:
	@echo "ğŸ“¦ æ•´ç†Goæ¨¡å—ä¾èµ–..."
	go mod tidy

# æ¸…ç†
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -f rxgo-examples
	rm -f *.prof
	rm -f *.pprof

# æŸ¥çœ‹å¸®åŠ©
help:
	@echo "RxGo é«˜å¹¶å‘æ•°æ®å¤„ç†ç¤ºä¾‹ - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "  make run          - è¿è¡Œæ‰€æœ‰ç¤ºä¾‹"
	@echo "  make build        - æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶"
	@echo "  make clean        - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo ""
	@echo "å•ä¸ªç¤ºä¾‹:"
	@echo "  make run-pipeline    - æ•°æ®å¤„ç†ç®¡é“"
	@echo "  make run-batch       - æ‰¹å¤„ç†"
	@echo "  make run-crawler     - ç½‘ç»œçˆ¬è™«"
	@echo "  make run-analytics   - æ—¥å¿—åˆ†æ"
	@echo "  make run-stream      - æµå¤„ç†"
	@echo "  make run-mapreduce   - MapReduce"
	@echo ""
	@echo "å¼€å‘å·¥å…·:"
	@echo "  make test         - è¿è¡Œæµ‹è¯•"
	@echo "  make benchmark    - æ€§èƒ½åŸºå‡†æµ‹è¯•"
	@echo "  make profile      - æ€§èƒ½åˆ†æ"
	@echo "  make fmt          - æ ¼å¼åŒ–ä»£ç "
	@echo "  make lint         - ä»£ç æ£€æŸ¥"
	@echo "  make mod-tidy     - æ•´ç†ä¾èµ–"
	@echo ""

# æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
info:
	@echo "ç³»ç»Ÿä¿¡æ¯:"
	@echo "Goç‰ˆæœ¬: $(shell go version)"
	@echo "CPUæ ¸å¿ƒæ•°: $(shell go run -c 'package main; import ("fmt"; "runtime"); func main() { fmt.Println(runtime.NumCPU()) }')"
	@echo "æ“ä½œç³»ç»Ÿ: $(shell go env GOOS)"
	@echo "æ¶æ„: $(shell go env GOARCH)" 